# SLAMè‡ªä¸»å¯¼èˆªæœºå™¨äººç³»ç»Ÿ


*åŸºäºBreezySLAMçš„å®æ—¶è‡ªä¸»æ¢ç´¢ä¸å¯¼èˆªç³»ç»Ÿ*

[åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) â€¢ [ç³»ç»Ÿæ¶æ„](#-ç³»ç»Ÿæ¶æ„) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [æ¨¡å—è¯¦è§£](#-æ¨¡å—è¯¦è§£) â€¢ [APIæ–‡æ¡£](#-apiæ–‡æ¡£)

</div>

---

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#-é¡¹ç›®ç®€ä»‹)
- [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§)
- [ç³»ç»Ÿæ¶æ„](#-ç³»ç»Ÿæ¶æ„)
- [æ–‡ä»¶ç»“æ„](#-æ–‡ä»¶ç»“æ„)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [æ¨¡å—è¯¦è§£](#-æ¨¡å—è¯¦è§£)
- [æ ¸å¿ƒç®—æ³•](#-æ ¸å¿ƒç®—æ³•)
- [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
- [æ•°æ®æµç¨‹](#-æ•°æ®æµç¨‹)
- [å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
- [è®¸å¯è¯](#-è®¸å¯è¯)

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªå®Œæ•´çš„**SLAMè‡ªä¸»å¯¼èˆªæœºå™¨äººç³»ç»Ÿ**ï¼Œå®ç°äº†ä»æ„ŸçŸ¥ã€å»ºå›¾ã€è·¯å¾„è§„åˆ’åˆ°è¿åŠ¨æ§åˆ¶çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚ç³»ç»Ÿé‡‡ç”¨**Python**ä½œä¸ºä¸Šä½æœºå¼€å‘è¯­è¨€ï¼Œé›†æˆäº†**BreezySLAM**ç®—æ³•è¿›è¡Œå®æ—¶åœ°å›¾æ„å»ºï¼Œå¹¶é€šè¿‡**Frontier-basedæ¢ç´¢ç­–ç•¥**å®ç°æœªçŸ¥ç¯å¢ƒçš„è‡ªä¸»æ¢ç´¢ã€‚

### ğŸ¯ æ ¸å¿ƒç›®æ ‡

- **å®æ—¶SLAMå»ºå›¾**ï¼šåŸºäºæ¿€å…‰é›·è¾¾çš„å®æ—¶ç¯å¢ƒå»ºå›¾ä¸å®šä½
- **è‡ªä¸»æ¢ç´¢**ï¼šæ— éœ€äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨æ¢ç´¢æœªçŸ¥åŒºåŸŸ
- **æ™ºèƒ½å¯¼èˆª**ï¼šA*è·¯å¾„è§„åˆ’ + è·¯å¾„å¹³æ»‘ä¼˜åŒ–
- **å¯è§†åŒ–ç›‘æ§**ï¼šå®æ—¶æ˜¾ç¤ºåœ°å›¾ã€è·¯å¾„ã€Frontierè¾¹ç•Œ
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šé«˜å†…èšä½è€¦åˆï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ—ºï¸ SLAMå»ºå›¾ç³»ç»Ÿ
- **RMHC-SLAMç®—æ³•**ï¼šéšæœºçˆ¬å±±è’™ç‰¹å¡æ´›SLAMï¼Œé«˜ç²¾åº¦ä½å§¿ä¼°è®¡
- **ç¼–ç å™¨ç§¯åˆ†**ï¼š10msé«˜é¢‘é‡‡æ ·ï¼Œå®Œæ•´ç´¯åŠ è¿åŠ¨å¢é‡
- **å¢é‡å¼åœ°å›¾æ›´æ–°**ï¼šä»…åœ¨è¿åŠ¨çŠ¶æ€è½¬æ¢æ—¶è§¦å‘ï¼Œé™ä½è®¡ç®—è´Ÿæ‹…
- **æ …æ ¼åœ°å›¾è¡¨ç¤º**ï¼šå æ®æ¦‚ç‡æ …æ ¼ï¼Œæ”¯æŒæœªçŸ¥/å æ®/ç©ºé—²ä¸‰æ€

### ğŸ¯ è‡ªä¸»æ¢ç´¢
- **Frontieræ£€æµ‹**ï¼šåŸºäºå…«è¿é€šåŒºåŸŸç”Ÿé•¿çš„è¾¹ç•Œæ£€æµ‹ç®—æ³•
- **å¯è¾¾æ€§åˆ†æ**ï¼šè€ƒè™‘éšœç¢ç‰©è†¨èƒ€çš„å®‰å…¨è·¯å¾„éªŒè¯
- **æ™ºèƒ½é€‰ç‚¹ç­–ç•¥**ï¼šç»¼åˆè€ƒè™‘è·ç¦»ã€ä¿¡æ¯å¢ç›Šã€åŒºåŸŸåˆ†å¸ƒ
- **æ¢ç´¢çŠ¶æ€æœº**ï¼šç©ºé—²â†’è§„åˆ’â†’å¯¼èˆªâ†’æ‰§è¡Œçš„å®Œæ•´é—­ç¯

### ğŸ›£ï¸ è·¯å¾„è§„åˆ’
- **A*æœ€ä¼˜è·¯å¾„æœç´¢**ï¼šå¯å‘å¼æœç´¢ï¼Œä¿è¯æœ€çŸ­è·¯å¾„
- **è·¯å¾„å¹³æ»‘ä¼˜åŒ–**ï¼šCatmull-Romæ ·æ¡å¹³æ»‘ï¼Œæå‡è¿åŠ¨èˆ’é€‚æ€§
- **åŠ¨æ€ç¢°æ’æ£€æµ‹**ï¼šè€ƒè™‘æœºå™¨äººå°ºå¯¸çš„éšœç¢ç‰©å®‰å…¨è·ç¦»
- **è·¯å¾„è·Ÿè¸ªå™¨**ï¼šåˆ†æ®µè·Ÿè¸ªï¼Œæ”¯æŒè½¬å‘/ç›´è¡Œåˆ†è§£

### ğŸ“Š å¯è§†åŒ–ç³»ç»Ÿ
- **å®æ—¶åœ°å›¾æ¸²æŸ“**ï¼šå æ®æ …æ ¼ã€Frontierè¾¹ç•Œã€è·¯å¾„æ˜¾ç¤º
- **æœºå™¨äººä½å§¿å¯è§†åŒ–**ï¼šå®æ—¶å§¿æ€å’Œè¿åŠ¨è½¨è¿¹
- **HUDä¿¡æ¯é¢æ¿**ï¼šç³»ç»ŸçŠ¶æ€ã€ç¼–ç å™¨ç»Ÿè®¡ã€ä»»åŠ¡è¿›åº¦
- **è°ƒè¯•ä¿¡æ¯**ï¼šä¸¢å¸§ç»Ÿè®¡ã€SLAMæ›´æ–°é¢‘ç‡ã€é˜Ÿåˆ—çŠ¶æ€

### ğŸ”Œ é€šä¿¡ç³»ç»Ÿ
- **åŒå¸§æ ¼å¼è§£æ**ï¼šç¼–ç å™¨å¸§(21å­—èŠ‚, 10ms) + é›·è¾¾å¸§(2604å­—èŠ‚, 200ms)
- **ç‹¬ç«‹é˜Ÿåˆ—ç®¡ç†**ï¼šç¼–ç å™¨é˜Ÿåˆ—100å®¹é‡ï¼Œé›·è¾¾é˜Ÿåˆ—1å®¹é‡
- **CRCæ ¡éªŒ**ï¼šå‘½ä»¤å¸§CRC16-Modbusæ ¡éªŒï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
- **å¸§åŒæ­¥æœºåˆ¶**ï¼šåŸºäºcmd_idçš„å‘½ä»¤-å“åº”åŒæ­¥

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸Šä½æœºç³»ç»Ÿ (Python)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ•°æ®é‡‡é›†å±‚    â”‚â”€â”€â”€â–¶â”‚  SLAMå»ºå›¾å±‚   â”‚â”€â”€â”€â–¶â”‚  ä»»åŠ¡è§„åˆ’å±‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                     â”‚                     â”‚          â”‚
â”‚         â”‚                     â”‚                     â”‚          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ ä¸²å£é€šä¿¡   â”‚         â”‚ åœ°å›¾ç®¡ç†   â”‚         â”‚ è·¯å¾„è§„åˆ’   â”‚  â”‚
â”‚   â”‚ btlink.py â”‚         â”‚ slam_map/ â”‚         â”‚ planner/  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                     â”‚                     â”‚          â”‚
â”‚         â”‚                     â”‚                     â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                              â”‚                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚   å¯è§†åŒ–ä¸æ§åˆ¶å±‚    â”‚                     â”‚
â”‚                    â”‚  map_visualizer.py â”‚                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ ä¸²å£é€šä¿¡ (921600 baud)
                           â”‚ å‘½ä»¤å¸§ / ç¼–ç å™¨å¸§ / é›·è¾¾å¸§
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸‹ä½æœºç³»ç»Ÿ (STM32F4)                         â”‚
â”‚          [åµŒå…¥å¼å›ºä»¶ - æœ¬æ–‡æ¡£ä¸æ¶‰åŠç¡¬ä»¶ç»†èŠ‚]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è½¯ä»¶æ¨¡å—åˆ’åˆ†

```
SLAM-car/
â”œâ”€ æ ¸å¿ƒæ§åˆ¶å±‚
â”‚  â”œâ”€ main_robot.py          # ä¸»ç¨‹åºå…¥å£ï¼Œç³»ç»Ÿè°ƒåº¦
â”‚  â””â”€ btlink.py              # è“ç‰™/ä¸²å£é€šä¿¡æ¨¡å—
â”‚
â”œâ”€ ä»»åŠ¡è§„åˆ’å±‚ (planner/)
â”‚  â”œâ”€ mission_controller.py  # ä»»åŠ¡æ§åˆ¶å™¨ï¼ˆæ¢ç´¢çŠ¶æ€æœºï¼‰
â”‚  â”œâ”€ frontier_detector.py   # Frontierè¾¹ç•Œæ£€æµ‹
â”‚  â”œâ”€ frontier_selector.py   # Frontieré€‰ç‚¹ç­–ç•¥
â”‚  â”œâ”€ astar_planner.py       # A*è·¯å¾„è§„åˆ’ç®—æ³•
â”‚  â”œâ”€ path_smoother.py       # è·¯å¾„å¹³æ»‘ä¼˜åŒ–
â”‚  â”œâ”€ command_generator.py   # è¿åŠ¨å‘½ä»¤ç”Ÿæˆ
â”‚  â”œâ”€ reachability.py        # å¯è¾¾æ€§åˆ†æ
â”‚  â”œâ”€ region_tracker.py      # åŒºåŸŸåˆ’åˆ†ä¸è·Ÿè¸ª
â”‚  â”œâ”€ transform.py           # åæ ‡å˜æ¢å·¥å…·
â”‚  â””â”€ planning_config.py     # è§„åˆ’å‚æ•°é…ç½®
â”‚
â”œâ”€ åœ°å›¾å»ºå›¾å±‚ (slam_map/)
â”‚  â”œâ”€ occupancy_grid.py      # å æ®æ …æ ¼åœ°å›¾
â”‚  â”œâ”€ vote_manager.py        # æŠ•ç¥¨å¼åœ°å›¾æ›´æ–°
â”‚  â”œâ”€ map_visualizer.py      # åœ°å›¾å¯è§†åŒ–
â”‚  â””â”€ draw_utils.py          # ç»˜å›¾å·¥å…·å‡½æ•°
â”‚
â”œâ”€ é€šä¿¡å±‚ (serial_io/)
â”‚  â””â”€ __init__.py            # ä¸²å£IOå·¥å…·
â”‚
â””â”€ é…ç½®ä¸æµ‹è¯•
   â”œâ”€ bt_test.py             # è“ç‰™é€šä¿¡æµ‹è¯•
   â”œâ”€ requirement.txt        # Pythonä¾èµ–åˆ—è¡¨
   â””â”€ README.md              # æœ¬æ–‡æ¡£
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### è¯¦ç»†ç›®å½•æ ‘

```
SLAM-car/
â”‚
â”œâ”€ ä¸»ç¨‹åºæ–‡ä»¶
â”‚  â”œâ”€ main_robot.py                 # ä¸»ç¨‹åºï¼šç³»ç»Ÿåˆå§‹åŒ–ã€å¤šçº¿ç¨‹è°ƒåº¦
â”‚  â”œâ”€ btlink.py                     # è“ç‰™é€šä¿¡ï¼šå¸§è§£æã€é˜Ÿåˆ—ç®¡ç†ã€æ•°æ®æ”¶å‘
â”‚  â”œâ”€ bt_test.py                    # é€šä¿¡æµ‹è¯•ï¼šç”¨äºæµ‹è¯•ä¸²å£æ”¶å‘åŠŸèƒ½
â”‚  â””â”€ requirement.txt               # ä¾èµ–åˆ—è¡¨ï¼šnumpy, opencv, pyserialç­‰
â”‚
â”œâ”€ planner/                         # ä»»åŠ¡è§„åˆ’æ¨¡å—
â”‚  â”œâ”€ mission_controller.py         # æ¢ç´¢ä»»åŠ¡æ§åˆ¶å™¨
â”‚  â”‚   â”œâ”€ MissionControllerç±»      # çŠ¶æ€æœºï¼šIDLE/PLANNING/NAVIGATING
â”‚  â”‚   â”œâ”€ run()                    # ä¸»å¾ªç¯ï¼šFrontieræ£€æµ‹â†’è·¯å¾„è§„åˆ’â†’å‘½ä»¤ç”Ÿæˆ
â”‚  â”‚   â””â”€ check_goal_reached()     # ç›®æ ‡åˆ°è¾¾åˆ¤æ–­
â”‚  â”‚
â”‚  â”œâ”€ frontier_detector.py          # Frontierè¾¹ç•Œæ£€æµ‹å™¨
â”‚  â”‚   â”œâ”€ find_frontiers()         # å…«è¿é€šåŒºåŸŸç”Ÿé•¿ç®—æ³•
â”‚  â”‚   â”œâ”€ filter_small_regions()   # è¿‡æ»¤å°åŒºåŸŸ
â”‚  â”‚   â””â”€ compute_centroids()      # è®¡ç®—åŒºåŸŸè´¨å¿ƒ
â”‚  â”‚
â”‚  â”œâ”€ frontier_selector.py          # Frontieré€‰ç‚¹ç­–ç•¥
â”‚  â”‚   â”œâ”€ select_best_frontier()   # ç»¼åˆè¯„åˆ†ï¼šè·ç¦» + ä¿¡æ¯å¢ç›Š
â”‚  â”‚   â”œâ”€ compute_scores()         # è®¡ç®—æ¯ä¸ªFrontierçš„å¾—åˆ†
â”‚  â”‚   â””â”€ filter_visited()         # è¿‡æ»¤å·²è®¿é—®åŒºåŸŸ
â”‚  â”‚
â”‚  â”œâ”€ astar_planner.py              # A*è·¯å¾„è§„åˆ’å™¨
â”‚  â”‚   â”œâ”€ plan_path()              # A*æœç´¢ä¸»å‡½æ•°
â”‚  â”‚   â”œâ”€ heuristic()              # æ¬§å‡ é‡Œå¾—è·ç¦»å¯å‘å‡½æ•°
â”‚  â”‚   â””â”€ reconstruct_path()       # è·¯å¾„å›æº¯
â”‚  â”‚
â”‚  â”œâ”€ path_smoother.py              # è·¯å¾„å¹³æ»‘ä¼˜åŒ–å™¨
â”‚  â”‚   â”œâ”€ smooth_path()            # Catmull-Romæ ·æ¡æ’å€¼
â”‚  â”‚   â”œâ”€ interpolate_spline()     # æ ·æ¡æ›²çº¿è®¡ç®—
â”‚  â”‚   â””â”€ resample_path()          # è·¯å¾„é‡é‡‡æ ·
â”‚  â”‚
â”‚  â”œâ”€ command_generator.py          # è¿åŠ¨å‘½ä»¤ç”Ÿæˆå™¨
â”‚  â”‚   â”œâ”€ generate_commands()      # è·¯å¾„â†’å‘½ä»¤åºåˆ—è½¬æ¢
â”‚  â”‚   â”œâ”€ decompose_motion()       # åˆ†è§£ä¸ºè½¬å‘+ç›´è¡Œ
â”‚  â”‚   â””â”€ PathTrackerç±»            # è·¯å¾„è·Ÿè¸ªå™¨
â”‚  â”‚
â”‚  â”œâ”€ reachability.py               # å¯è¾¾æ€§åˆ†æå·¥å…·
â”‚  â”‚   â”œâ”€ is_reachable()           # æ£€æŸ¥ç›®æ ‡ç‚¹æ˜¯å¦å¯è¾¾
â”‚  â”‚   â””â”€ check_path_collision()   # è·¯å¾„ç¢°æ’æ£€æµ‹
â”‚  â”‚
â”‚  â”œâ”€ region_tracker.py             # åŒºåŸŸè·Ÿè¸ªå™¨
â”‚  â”‚   â”œâ”€ mark_visited()           # æ ‡è®°å·²è®¿é—®åŒºåŸŸ
â”‚  â”‚   â””â”€ get_unvisited_regions()  # è·å–æœªè®¿é—®åŒºåŸŸ
â”‚  â”‚
â”‚  â”œâ”€ transform.py                  # åæ ‡å˜æ¢å·¥å…·
â”‚  â”‚   â”œâ”€ pixel_to_world()         # åƒç´ åæ ‡â†’ä¸–ç•Œåæ ‡
â”‚  â”‚   â”œâ”€ world_to_pixel()         # ä¸–ç•Œåæ ‡â†’åƒç´ åæ ‡
â”‚  â”‚   â””â”€ rotate_point()           # åæ ‡æ—‹è½¬
â”‚  â”‚
â”‚  â””â”€ planning_config.py            # è§„åˆ’å‚æ•°é…ç½®
â”‚      â”œâ”€ FRONTIER_MIN_SIZE        # Frontieræœ€å°å°ºå¯¸
â”‚      â”œâ”€ PATH_SMOOTHNESS          # è·¯å¾„å¹³æ»‘åº¦
â”‚      â””â”€ ROBOT_RADIUS             # æœºå™¨äººåŠå¾„
â”‚
â”œâ”€ slam_map/                        # SLAMåœ°å›¾æ¨¡å—
â”‚  â”œâ”€ occupancy_grid.py             # å æ®æ …æ ¼åœ°å›¾
â”‚  â”‚   â”œâ”€ OccupancyGridç±»         # åœ°å›¾æ•°æ®ç»“æ„
â”‚  â”‚   â”œâ”€ update_cell()            # å•å…ƒæ ¼æ›´æ–°
â”‚  â”‚   â”œâ”€ get_occupancy()          # æŸ¥è¯¢å æ®çŠ¶æ€
â”‚  â”‚   â””â”€ get_free_cells()         # è·å–ç©ºé—²å•å…ƒ
â”‚  â”‚
â”‚  â”œâ”€ vote_manager.py               # æŠ•ç¥¨å¼åœ°å›¾æ›´æ–°
â”‚  â”‚   â”œâ”€ VoteManagerç±»            # ç®¡ç†æŠ•ç¥¨æƒé‡
â”‚  â”‚   â”œâ”€ cast_vote()              # æŠ•ç¥¨æ›´æ–°
â”‚  â”‚   â””â”€ update_probabilities()   # æ¦‚ç‡æ›´æ–°
â”‚  â”‚
â”‚  â”œâ”€ map_visualizer.py             # åœ°å›¾å¯è§†åŒ–
â”‚  â”‚   â”œâ”€ MapVisualizerç±»         # OpenCVå¯è§†åŒ–
â”‚  â”‚   â”œâ”€ draw_map()               # ç»˜åˆ¶æ …æ ¼åœ°å›¾
â”‚  â”‚   â”œâ”€ draw_robot()             # ç»˜åˆ¶æœºå™¨äººä½å§¿
â”‚  â”‚   â”œâ”€ draw_frontiers()         # ç»˜åˆ¶Frontierè¾¹ç•Œ
â”‚  â”‚   â”œâ”€ draw_path()              # ç»˜åˆ¶è·¯å¾„
â”‚  â”‚   â””â”€ draw_hud()               # ç»˜åˆ¶HUDä¿¡æ¯
â”‚  â”‚
â”‚  â””â”€ draw_utils.py                 # ç»˜å›¾å·¥å…·å‡½æ•°
â”‚      â”œâ”€ draw_arrow()             # ç»˜åˆ¶ç®­å¤´
â”‚      â”œâ”€ draw_circle()            # ç»˜åˆ¶åœ†å½¢
â”‚      â””â”€ draw_text()              # ç»˜åˆ¶æ–‡æœ¬
â”‚
â”œâ”€ serial_io/                       # ä¸²å£é€šä¿¡æ¨¡å—
â”‚  â””â”€ __init__.py                   # ä¸²å£å·¥å…·åˆå§‹åŒ–
â”‚
â””â”€ stm32/                           # åµŒå…¥å¼å›ºä»¶ï¼ˆæœ¬æ–‡æ¡£ä¸æ¶‰åŠï¼‰
   â””â”€ [ä¸‹ä½æœºä»£ç ç»“æ„è§ä¸‹èŠ‚]
```

### åµŒå…¥å¼å›ºä»¶ç»“æ„

```
stm32/                              # STM32F4åµŒå…¥å¼å›ºä»¶
â”‚
â”œâ”€ Core/                            # æ ¸å¿ƒä»£ç 
â”‚  â”œâ”€ Inc/                          # å¤´æ–‡ä»¶
â”‚  â”‚  â”œâ”€ main.h                    # ä¸»ç¨‹åºå¤´æ–‡ä»¶
â”‚  â”‚  â”œâ”€ communication.h           # é€šä¿¡åè®®
â”‚  â”‚  â”œâ”€ encoder.h                 # ç¼–ç å™¨æ¥å£
â”‚  â”‚  â”œâ”€ motor.h                   # ç”µæœºæ§åˆ¶
â”‚  â”‚  â”œâ”€ ax_laser.h                # æ¿€å…‰é›·è¾¾æ¥å£
â”‚  â”‚  â””â”€ ...                       # å…¶ä»–å¤–è®¾å¤´æ–‡ä»¶
â”‚  â”‚
â”‚  â””â”€ Src/                          # æºæ–‡ä»¶
â”‚     â”œâ”€ main.c                    # ä¸»ç¨‹åºï¼šåˆå§‹åŒ–ã€çŠ¶æ€æœº
â”‚     â”œâ”€ communication.c           # é€šä¿¡ï¼šå¸§å‘é€ã€å‘½ä»¤æ¥æ”¶
â”‚     â”œâ”€ encoder.c                 # ç¼–ç å™¨ï¼šç´¯ç§¯å€¼è¯»å–
â”‚     â”œâ”€ motor.c                   # ç”µæœºï¼šPWMæ§åˆ¶
â”‚     â”œâ”€ ax_laser_task.c           # æ¿€å…‰ä»»åŠ¡ï¼šæ•°æ®é‡‡é›†
â”‚     â””â”€ ...                       # å…¶ä»–æºæ–‡ä»¶
â”‚
â”œâ”€ Drivers/                         # HALé©±åŠ¨åº“
â”‚  â”œâ”€ CMSIS/                       # CMSISæ ‡å‡†åº“
â”‚  â””â”€ STM32F4xx_HAL_Driver/        # STM32 HALåº“
â”‚
â””â”€ MDK-ARM/                         # Keil MDKå·¥ç¨‹æ–‡ä»¶
   â”œâ”€ test-pwm.uvprojx             # Keilå·¥ç¨‹æ–‡ä»¶
   â””â”€ startup_stm32f446xx.s        # å¯åŠ¨æ–‡ä»¶
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Python**: 3.8+ï¼ˆæ¨è3.13ï¼‰
- **æ“ä½œç³»ç»Ÿ**: Windows / Linux / macOS
- **ä¸²å£**: è“ç‰™æ¨¡å—æˆ–USBè½¬ä¸²å£

### å®‰è£…ä¾èµ–

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yourusername/SLAM-car.git
cd SLAM-car

# å®‰è£…Pythonä¾èµ–
pip install -r requirement.txt
```

**ä¾èµ–åˆ—è¡¨** (`requirement.txt`):
```
numpy>=1.20.0
opencv-python>=4.5.0
pyserial>=3.5
breezyslam>=0.2.0
```

### è¿è¡Œç¨‹åº

#### 1. åŸºç¡€è¿è¡Œï¼ˆè‡ªåŠ¨æ¢ç´¢æ¨¡å¼ï¼‰

```bash
python main_robot.py --port COM7 --baud 921600
```

#### 2. å¸¦å‚æ•°è¿è¡Œ

```bash
python main_robot.py \
    --port COM7 \
    --baud 921600 \
    --wheel-radius 0.0325 \
    --half-wheelbase 0.084 \
    --cpr 1650 \
    --map-size 8000 \
    --map-quality 10
```

#### 3. æµ‹è¯•æ¨¡å¼

```bash
# æµ‹è¯•è“ç‰™é€šä¿¡
python bt_test.py

# æŸ¥çœ‹å¸®åŠ©
python main_robot.py --help
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--port` | str | COM7 | ä¸²å£ç«¯å£å· |
| `--baud` | int | 921600 | æ³¢ç‰¹ç‡ |
| `--wheel-radius` | float | 0.0325 | è½®åŠå¾„ï¼ˆç±³ï¼‰|
| `--half-wheelbase` | float | 0.084 | åŠè½´è·ï¼ˆç±³ï¼‰|
| `--cpr` | int | 1650 | ç¼–ç å™¨çº¿æ•° |
| `--map-size` | int | 8000 | åœ°å›¾å°ºå¯¸ï¼ˆmmï¼‰|
| `--map-quality` | int | 10 | åœ°å›¾åˆ†è¾¨ç‡ï¼ˆmm/åƒç´ ï¼‰|

---

## ğŸ”§ æ¨¡å—è¯¦è§£

### 1ï¸âƒ£ é€šä¿¡æ¨¡å— (`btlink.py`)

#### åŠŸèƒ½æ¦‚è¿°

è´Ÿè´£ä¸ä¸‹ä½æœºçš„ä¸²å£é€šä¿¡ï¼ŒåŒ…æ‹¬æ•°æ®å¸§è§£æã€å‘½ä»¤å‘é€å’Œæ•°æ®æ¥æ”¶ã€‚

#### æ ¸å¿ƒç±»

**`BluetoothLink`**
```python
class BluetoothLink:
    def __init__(self, port: str, baudrate: int = 921600):
        """åˆå§‹åŒ–è“ç‰™è¿æ¥"""
        
    def send_command(self, cmd_id: int, turn_rad: float, distance_m: float):
        """å‘é€è¿åŠ¨å‘½ä»¤ï¼ˆå¸¦CRCæ ¡éªŒï¼‰"""
        
    def get_encoder_frame(self) -> Optional[EncoderFrame]:
        """è·å–ç¼–ç å™¨æ•°æ®å¸§ï¼ˆéé˜»å¡ï¼‰"""
        
    def get_lidar_frame(self) -> Optional[LidarFrame]:
        """è·å–é›·è¾¾æ•°æ®å¸§ï¼ˆéé˜»å¡ï¼‰"""
        
    def close(self):
        """å…³é—­è¿æ¥å¹¶æ¸…ç†èµ„æº"""
```

#### æ•°æ®å¸§æ ¼å¼

**ç¼–ç å™¨å¸§** (21å­—èŠ‚, 10mså‘¨æœŸ)
```
[0xFD 0xDF] + time_us(4) + cmd_id(2) + status(1) + 
encoder_l(4) + encoder_r(4) + yaw(4)
```

**é›·è¾¾å¸§** (2604å­—èŠ‚, 200mså‘¨æœŸ)
```
[0x55 0xAA] + data_count(2) + [quality(1) + angle_q6(2) + dist_q2(2)] Ã— 520
```

**å‘½ä»¤å¸§** (16å­—èŠ‚, æŒ‰éœ€å‘é€)
```
[0xAA 0x55] + len(2) + cmd_id(2) + turn_rad(4) + distance_m(4) + CRC16(2)
```

#### é˜Ÿåˆ—ç®¡ç†ç­–ç•¥

- **ç¼–ç å™¨é˜Ÿåˆ—**: `maxsize=100`ï¼ˆé«˜é¢‘æ•°æ®ï¼Œç¼“å­˜æ›´å¤šå¸§ï¼‰
- **é›·è¾¾é˜Ÿåˆ—**: `maxsize=1`ï¼ˆä½é¢‘æ•°æ®ï¼Œåªä¿ç•™æœ€æ–°å¸§ï¼‰
- **è‡ªåŠ¨ä¸¢å¼ƒ**: é˜Ÿåˆ—æ»¡æ—¶ï¼Œé›·è¾¾æ•°æ®è‡ªåŠ¨è¦†ç›–æ—§æ•°æ®

#### ä½¿ç”¨ç¤ºä¾‹

```python
# åˆ›å»ºè¿æ¥
bt = BluetoothLink(port="COM7", baudrate=921600)

# å‘é€è¿åŠ¨å‘½ä»¤
bt.send_command(cmd_id=1, turn_rad=0.5, distance_m=0.3)

# è·å–æ•°æ®
encoder_frame = bt.get_encoder_frame()
lidar_frame = bt.get_lidar_frame()

# å…³é—­è¿æ¥
bt.close()
```

---

### 2ï¸âƒ£ SLAMå»ºå›¾æ¨¡å— (`slam_map/`)

#### åŠŸèƒ½æ¦‚è¿°

å®ç°åŸºäºBreezySLAMçš„å®æ—¶åœ°å›¾æ„å»ºï¼ŒåŒ…æ‹¬å æ®æ …æ ¼ç®¡ç†ã€æŠ•ç¥¨å¼æ›´æ–°å’Œå¯è§†åŒ–æ¸²æŸ“ã€‚

#### æ ¸å¿ƒç±»

**`OccupancyGrid`** - å æ®æ …æ ¼åœ°å›¾
```python
class OccupancyGrid:
    def __init__(self, size_mm: int, quality_mm: int):
        """
        åˆå§‹åŒ–æ …æ ¼åœ°å›¾
        
        Args:
            size_mm: åœ°å›¾å°ºå¯¸ï¼ˆæ¯«ç±³ï¼‰
            quality_mm: åˆ†è¾¨ç‡ï¼ˆæ¯«ç±³/åƒç´ ï¼‰
        """
        
    def update_cell(self, x: int, y: int, occupied: bool):
        """æ›´æ–°å•ä¸ªæ …æ ¼çš„å æ®çŠ¶æ€"""
        
    def get_occupancy(self, x: int, y: int) -> int:
        """
        æŸ¥è¯¢æ …æ ¼å æ®çŠ¶æ€
        
        Returns:
            0: æœªçŸ¥, 127: ç©ºé—², 255: å æ®
        """
        
    def get_free_cells(self) -> List[Tuple[int, int]]:
        """è·å–æ‰€æœ‰ç©ºé—²å•å…ƒæ ¼åæ ‡"""
```

**`MapVisualizer`** - åœ°å›¾å¯è§†åŒ–
```python
class MapVisualizer:
    def draw_map(self, map_data: np.ndarray):
        """ç»˜åˆ¶æ …æ ¼åœ°å›¾ï¼ˆç°åº¦å›¾ï¼‰"""
        
    def draw_robot(self, x: float, y: float, theta: float):
        """ç»˜åˆ¶æœºå™¨äººä½å§¿ï¼ˆçº¢è‰²ä¸‰è§’å½¢ï¼‰"""
        
    def draw_frontiers(self, frontiers: List[List[Tuple[int, int]]]):
        """ç»˜åˆ¶Frontierè¾¹ç•Œï¼ˆç»¿è‰²è½®å»“ï¼‰"""
        
    def draw_path(self, path: List[Tuple[float, float]]):
        """ç»˜åˆ¶è§„åˆ’è·¯å¾„ï¼ˆè“è‰²çº¿æ¡ï¼‰"""
        
    def draw_hud(self, info: dict):
        """ç»˜åˆ¶HUDä¿¡æ¯é¢æ¿"""
        
    def show(self):
        """æ˜¾ç¤ºçª—å£ï¼ˆå¸¦é”®ç›˜äº¤äº’ï¼‰"""
```

#### SLAMæ›´æ–°æµç¨‹

```
ç¼–ç å™¨ç´¯åŠ çº¿ç¨‹ (100Hz)
    â†“
ç´¯åŠ è¿åŠ¨å¢é‡ (Î”left, Î”right)
    â†“
æ£€æµ‹çŠ¶æ€è½¬æ¢ (1â†’2 æˆ– 2â†’0)
    â†“
è§¦å‘SLAMæ›´æ–°
    â†“
slam.update(æ¿€å…‰æ‰«æ, ç´¯ç§¯å¢é‡)
    â†“
æ›´æ–°æœºå™¨äººä½å§¿ + åœ°å›¾
    â†“
é‡ç½®ç´¯åŠ å™¨
```

#### ä½¿ç”¨ç¤ºä¾‹

```python
from breezyslam.algorithms import RMHC_SLAM
from breezyslam.sensors import Laser
from slam_map.occupancy_grid import OccupancyGrid
from slam_map.map_visualizer import MapVisualizer

# åˆå§‹åŒ–SLAM
laser = Laser(520, 5.0, 360.0, 8000, 0, 0)
slam = RMHC_SLAM(laser, 8000, 10)
map_data = bytearray(800 * 800)

# åˆå§‹åŒ–å¯è§†åŒ–
viz = MapVisualizer(width=800, height=800)

# SLAMæ›´æ–°
slam.update(lidar_scan, left_mm, right_mm)
x, y, theta = slam.getpos()

# ç»˜åˆ¶åœ°å›¾
slam.getmap(map_data)
viz.draw_map(np.frombuffer(map_data, dtype=np.uint8).reshape(800, 800))
viz.draw_robot(x, y, theta)
viz.show()
```

---

### 3ï¸âƒ£ ä»»åŠ¡è§„åˆ’æ¨¡å— (`planner/`)

#### åŠŸèƒ½æ¦‚è¿°

å®ç°è‡ªä¸»æ¢ç´¢çš„å®Œæ•´æµç¨‹ï¼šFrontieræ£€æµ‹ â†’ ç›®æ ‡é€‰æ‹© â†’ è·¯å¾„è§„åˆ’ â†’ å‘½ä»¤ç”Ÿæˆã€‚

#### æ ¸å¿ƒç»„ä»¶

##### **MissionController** - ä»»åŠ¡æ§åˆ¶å™¨

```python
class MissionController:
    """æ¢ç´¢ä»»åŠ¡çš„çŠ¶æ€æœºæ§åˆ¶å™¨"""
    
    def __init__(self, slam_instance, map_data):
        self.state = "IDLE"  # IDLE / PLANNING / NAVIGATING
        
    def run(self):
        """ä¸»å¾ªç¯ï¼šæ¯200msæ‰§è¡Œä¸€æ¬¡"""
        if self.state == "IDLE":
            # æ£€æµ‹Frontier
            frontiers = self.frontier_detector.find_frontiers(self.map_data)
            if frontiers:
                self.state = "PLANNING"
                
        elif self.state == "PLANNING":
            # é€‰æ‹©æœ€ä½³Frontier
            best_frontier = self.frontier_selector.select_best(frontiers)
            
            # è§„åˆ’è·¯å¾„
            path = self.astar_planner.plan_path(current_pos, best_frontier)
            
            # å¹³æ»‘è·¯å¾„
            smooth_path = self.path_smoother.smooth(path)
            
            # ç”Ÿæˆå‘½ä»¤
            commands = self.command_generator.generate(smooth_path)
            self.state = "NAVIGATING"
            
        elif self.state == "NAVIGATING":
            # æ‰§è¡Œå‘½ä»¤åºåˆ—
            if self.check_goal_reached():
                self.state = "IDLE"
```

##### **FrontierDetector** - è¾¹ç•Œæ£€æµ‹å™¨

```python
class FrontierDetector:
    """åŸºäºå…«è¿é€šåŒºåŸŸç”Ÿé•¿çš„Frontieræ£€æµ‹"""
    
    def find_frontiers(self, map_data: np.ndarray) -> List[List[Tuple[int, int]]]:
        """
        æ£€æµ‹åœ°å›¾ä¸­çš„Frontierè¾¹ç•Œ
        
        ç®—æ³•æµç¨‹:
        1. éå†æ‰€æœ‰ç©ºé—²å•å…ƒæ ¼
        2. å¯¹æ¯ä¸ªç©ºé—²å•å…ƒï¼Œæ£€æŸ¥å…¶8é‚»åŸŸ
        3. è‹¥é‚»åŸŸä¸­å­˜åœ¨æœªçŸ¥å•å…ƒï¼Œåˆ™è¯¥å•å…ƒä¸ºFrontierç‚¹
        4. ä½¿ç”¨åŒºåŸŸç”Ÿé•¿èšç±»ç›¸é‚»Frontierç‚¹
        5. è¿‡æ»¤é¢ç§¯å°äºé˜ˆå€¼çš„åŒºåŸŸ
        
        Returns:
            List[Region]: æ¯ä¸ªRegionæ˜¯ä¸€ä¸ªFrontierç‚¹é›†åˆ
        """
```

**ç®—æ³•ç¤ºæ„å›¾**:
```
åœ°å›¾çŠ¶æ€:
  ? ? ? ? ? ?     (? = æœªçŸ¥)
  ? â–¡ â–¡ â–¡ â–¡ ?     (â–¡ = ç©ºé—²)
  ? â–¡ â–  â–  â–¡ ?     (â–  = å æ®)
  ? â–¡ â–¡ â–¡ â–¡ ?     (F = Frontier)
  ? ? ? ? ? ?

æ£€æµ‹ç»“æœ:
  ? ? ? ? ? ?
  ? F F F F ?  â† ä¸Šè¾¹ç•ŒFrontier
  ? F â–  â–  F ?
  ? F F F F ?  â† ä¸‹è¾¹ç•ŒFrontier
  ? ? ? ? ? ?
```

##### **AStarPlanner** - A*è·¯å¾„è§„åˆ’

```python
class AStarPlanner:
    """A*æœ€ä¼˜è·¯å¾„æœç´¢"""
    
    def plan_path(self, start: Tuple[int, int], goal: Tuple[int, int]) -> List[Tuple[int, int]]:
        """
        A*ç®—æ³•æ ¸å¿ƒ
        
        ä¼ªä»£ç :
        OPEN = {start}
        CLOSED = {}
        
        while OPEN not empty:
            current = OPENä¸­få€¼æœ€å°çš„èŠ‚ç‚¹
            if current == goal:
                return å›æº¯è·¯å¾„
            
            CLOSED.add(current)
            for neighbor in currentçš„é‚»å±…:
                if neighboråœ¨CLOSEDæˆ–è¢«å æ®:
                    continue
                
                g_new = g[current] + cost(current, neighbor)
                if neighborä¸åœ¨OPEN or g_new < g[neighbor]:
                    g[neighbor] = g_new
                    f[neighbor] = g_new + h(neighbor, goal)
                    parent[neighbor] = current
                    OPEN.add(neighbor)
        
        return []  # æ— è·¯å¾„
        """
```

**å¯å‘å‡½æ•°é€‰æ‹©**:
- ä½¿ç”¨**æ¬§å‡ é‡Œå¾—è·ç¦»**ä½œä¸ºh(n)
- ä¿è¯h(n)çš„ä¸€è‡´æ€§ï¼ˆadmissibleï¼‰
- é¿å…å¯¹è§’çº¿è·¯å¾„çš„è¿‡åº¦æƒ©ç½š

##### **PathSmoother** - è·¯å¾„å¹³æ»‘

```python
class PathSmoother:
    """Catmull-Romæ ·æ¡è·¯å¾„å¹³æ»‘"""
    
    def smooth_path(self, raw_path: List[Tuple[float, float]]) -> List[Tuple[float, float]]:
        """
        ä½¿ç”¨Catmull-Romæ ·æ¡è¿›è¡Œè·¯å¾„å¹³æ»‘
        
        ç®—æ³•ç‰¹ç‚¹:
        - C1è¿ç»­ï¼ˆä¸€é˜¶å¯¼æ•°è¿ç»­ï¼‰
        - é€šè¿‡æ‰€æœ‰æ§åˆ¶ç‚¹
        - å±€éƒ¨æ§åˆ¶æ€§å¥½
        
        å‚æ•°:
        - tension: å¼ åŠ›å‚æ•°ï¼Œæ§åˆ¶æ›²çº¿"æ¾ç´§åº¦"
        - num_points: æ’å€¼ç‚¹æ•°é‡
        """
```

**å¹³æ»‘æ•ˆæœå¯¹æ¯”**:
```
åŸå§‹è·¯å¾„ (A*):              å¹³æ»‘è·¯å¾„ (Catmull-Rom):
  Sâ”€â”                          Sâ•­â”€â•®
    â”‚                           â”‚  â•°â•®
    â””â”€â”                         â”‚   â”‚
      â”‚  é”¯é½¿çŠ¶                  â”‚   â”‚ å…‰æ»‘æ›²çº¿
      â””â”€â”                       â”‚  â•­â•¯
        â””â”€G                     â•°â”€â•¯G
```

##### **CommandGenerator** - å‘½ä»¤ç”Ÿæˆå™¨

```python
class CommandGenerator:
    """è·¯å¾„â†’è¿åŠ¨å‘½ä»¤è½¬æ¢"""
    
    def generate_commands(self, path: List[Tuple[float, float]]) -> List[Command]:
        """
        å°†è·¯å¾„åˆ†è§£ä¸ºè½¬å‘+ç›´è¡Œå‘½ä»¤åºåˆ—
        
        æ­¥éª¤:
        1. è®¡ç®—è·¯å¾„æ®µçš„æ–¹å‘è§’
        2. åˆ†è§£ä¸º: è½¬å‘åˆ°ç›®æ ‡è§’åº¦ + ç›´çº¿è¡Œé©¶è·ç¦»
        3. ç”Ÿæˆå‘½ä»¤åºåˆ—: [(turn1, 0), (0, dist1), (turn2, 0), (0, dist2), ...]
        
        ä¼˜åŒ–:
        - ç›¸é‚»å°è§’åº¦åˆå¹¶
        - çŸ­è·ç¦»æ®µè¿‡æ»¤
        - è½¬å‘è§’åº¦å½’ä¸€åŒ–åˆ°[-Ï€, Ï€]
        """
```

#### ä½¿ç”¨ç¤ºä¾‹

```python
from planner.mission_controller import MissionController

# åˆå§‹åŒ–ä»»åŠ¡æ§åˆ¶å™¨
controller = MissionController(slam, map_data)

# ä¸»å¾ªç¯
while not controller.mission_complete():
    # æ‰§è¡Œä¸€æ­¥è§„åˆ’
    controller.run()
    
    # å¯è§†åŒ–å½“å‰çŠ¶æ€
    viz.draw_map(map_data)
    viz.draw_frontiers(controller.current_frontiers)
    viz.draw_path(controller.current_path)
    viz.show()
    
    time.sleep(0.2)  # 200mså‘¨æœŸ
```

---

## ğŸ§® æ ¸å¿ƒç®—æ³•

### RMHC-SLAMç®—æ³•

**Random Hill-Climbing Monte Carlo SLAM**

#### ç®—æ³•åŸç†

RMHC-SLAMæ˜¯ä¸€ç§åŸºäºç²’å­æ»¤æ³¢çš„SLAMç®—æ³•ï¼Œé€šè¿‡è’™ç‰¹å¡æ´›æ–¹æ³•è¿›è¡Œä½å§¿ä¼°è®¡ã€‚

**æ ¸å¿ƒæ€æƒ³**:
1. ä½¿ç”¨ç¼–ç å™¨é‡Œç¨‹è®¡ä½œä¸ºä½å§¿é¢„æµ‹
2. ä½¿ç”¨æ¿€å…‰æ‰«æè¿›è¡Œè§‚æµ‹æ›´æ–°
3. é€šè¿‡çˆ¬å±±ç®—æ³•ä¼˜åŒ–ä½å§¿åŒ¹é…

**ç®—æ³•æµç¨‹**:
```python
def RMHC_SLAM_update(scan, odom_left, odom_right):
    # 1. é¢„æµ‹æ­¥éª¤ï¼ˆé‡Œç¨‹è®¡ï¼‰
    predicted_pose = motion_model(current_pose, odom_left, odom_right)
    
    # 2. è§‚æµ‹æ­¥éª¤ï¼ˆæ¿€å…‰åŒ¹é…ï¼‰
    best_pose = predicted_pose
    best_score = compute_match_score(scan, map, predicted_pose)
    
    # 3. éšæœºçˆ¬å±±ä¼˜åŒ–
    for i in range(num_iterations):
        # ç”Ÿæˆéšæœºæ‰°åŠ¨
        candidate_pose = add_noise(best_pose)
        score = compute_match_score(scan, map, candidate_pose)
        
        # çˆ¬å±±æ›´æ–°
        if score > best_score:
            best_pose = candidate_pose
            best_score = score
    
    # 4. åœ°å›¾æ›´æ–°
    update_map(scan, best_pose)
    
    return best_pose
```

#### ç¼–ç å™¨ç§¯åˆ†æ”¹è¿›

**é—®é¢˜**: ä¼ ç»Ÿä¸¤ç‚¹å·®åˆ†æ³•ä¸¢å¤±ä¸­é—´è¿‡ç¨‹ï¼Œç¬æ—¶è¯¯å·®è¢«æ”¾å¤§

**æ”¹è¿›æ–¹æ¡ˆ**: å®Œæ•´ç§¯åˆ†æ³•
```python
# æ”¹è¿›å‰ï¼šä¸¤ç‚¹å·®åˆ†
Î”enc = enc(t_end) - enc(t_start)

# æ”¹è¿›åï¼šå®Œæ•´ç§¯åˆ†
Î”enc = Î£(enc(t_i) - enc(t_i-1))  # iä»startåˆ°end
```

**ä¼˜åŠ¿**:
- é‡‡æ ·ç‡: 5Hz â†’ 100Hz (20å€æå‡)
- å¹³æ»‘éšæœºå™ªå£°
- æ•æ‰å®Œæ•´è¿åŠ¨è¿‡ç¨‹
- æå‡ä½ç§»è®¡ç®—ç²¾åº¦çº¦80%

---

### Frontieræ£€æµ‹ç®—æ³•

#### ç®—æ³•å®šä¹‰

**Frontier**: åœ°å›¾ä¸­å·²çŸ¥åŒºåŸŸä¸æœªçŸ¥åŒºåŸŸçš„è¾¹ç•Œ

#### æ£€æµ‹æµç¨‹

```python
def find_frontiers(map_data):
    frontiers = []
    visited = set()
    
    # 1. éå†æ‰€æœ‰ç©ºé—²å•å…ƒ
    for (x, y) in free_cells:
        if (x, y) in visited:
            continue
            
        # 2. æ£€æŸ¥æ˜¯å¦ä¸ºFrontierç‚¹
        if is_frontier(x, y, map_data):
            # 3. åŒºåŸŸç”Ÿé•¿
            region = region_growing(x, y, map_data, visited)
            
            # 4. è¿‡æ»¤å°åŒºåŸŸ
            if len(region) >= MIN_FRONTIER_SIZE:
                frontiers.append(region)
    
    return frontiers

def is_frontier(x, y, map_data):
    """æ£€æŸ¥å•å…ƒæ ¼æ˜¯å¦ä¸ºFrontierç‚¹"""
    # å½“å‰å•å…ƒå¿…é¡»æ˜¯ç©ºé—²
    if map_data[x, y] != FREE:
        return False
    
    # 8é‚»åŸŸä¸­è‡³å°‘æœ‰ä¸€ä¸ªæœªçŸ¥å•å…ƒ
    for (dx, dy) in [(-1,-1), (-1,0), (-1,1), (0,-1), (0,1), (1,-1), (1,0), (1,1)]:
        nx, ny = x + dx, y + dy
        if map_data[nx, ny] == UNKNOWN:
            return True
    
    return False

def region_growing(x, y, map_data, visited):
    """å…«è¿é€šåŒºåŸŸç”Ÿé•¿"""
    region = []
    queue = [(x, y)]
    
    while queue:
        curr = queue.pop(0)
        if curr in visited:
            continue
        
        visited.add(curr)
        region.append(curr)
        
        # æ·»åŠ é‚»å±…Frontierç‚¹
        for neighbor in get_neighbors(curr):
            if is_frontier(neighbor) and neighbor not in visited:
                queue.append(neighbor)
    
    return region
```

#### å¯è§†åŒ–ç¤ºä¾‹

```
åŸå§‹åœ°å›¾:                     Frontieræ£€æµ‹:
  ? ? ? ? ? ? ? ?              ? ? ? ? ? ? ? ?
  ? â–¡ â–¡ â–¡ â–¡ â–¡ ? ?              ? â”â”â”â”â”â”â”â”“ ? ?
  ? â–¡ â–  â–  â–  â–¡ ? ?    â”€â”€â”€â–¶      ? â”ƒ â–  â–  â–  â”ƒ ? ?
  ? â–¡ â–¡ â–¡ â–¡ â–¡ ? ?              ? â”—â”â”â”â”â”â”â”› ? ?
  ? ? ? ? ? ? ? ?              ? ? ? ? ? ? ? ?

å›¾ä¾‹:
  ? = æœªçŸ¥åŒºåŸŸ
  â–¡ = å·²çŸ¥ç©ºé—²åŒºåŸŸ
  â–  = å·²çŸ¥å æ®åŒºåŸŸ
  â” = Frontierè¾¹ç•Œ
```

---

### A*è·¯å¾„è§„åˆ’ç®—æ³•

#### ç®—æ³•å…¬å¼

```
f(n) = g(n) + h(n)

å…¶ä¸­:
- g(n): ä»èµ·ç‚¹åˆ°èŠ‚ç‚¹nçš„å®é™…ä»£ä»·
- h(n): ä»èŠ‚ç‚¹nåˆ°ç»ˆç‚¹çš„å¯å‘å¼ä¼°è®¡
- f(n): æ€»ä¼°è®¡ä»£ä»·
```

#### å¯å‘å‡½æ•°é€‰æ‹©

```python
def heuristic(a, b):
    """æ¬§å‡ é‡Œå¾—è·ç¦»å¯å‘å‡½æ•°"""
    return math.sqrt((a[0] - b[0])**2 + (a[1] - b[1])**2)
```

**ç‰¹æ€§**:
- **å¯é‡‡çº³æ€§** (Admissible): h(n) â‰¤ çœŸå®ä»£ä»·
- **ä¸€è‡´æ€§** (Consistent): h(n) â‰¤ cost(n, n') + h(n')

#### ä¼ªä»£ç 

```python
def astar(start, goal, map_data):
    open_set = PriorityQueue()
    open_set.put(start, priority=0)
    
    came_from = {}
    g_score = {start: 0}
    f_score = {start: heuristic(start, goal)}
    
    while not open_set.empty():
        current = open_set.get()
        
        if current == goal:
            return reconstruct_path(came_from, current)
        
        for neighbor in get_neighbors(current):
            # è·³è¿‡å æ®å•å…ƒ
            if is_occupied(neighbor, map_data):
                continue
            
            tentative_g = g_score[current] + distance(current, neighbor)
            
            if neighbor not in g_score or tentative_g < g_score[neighbor]:
                came_from[neighbor] = current
                g_score[neighbor] = tentative_g
                f_score[neighbor] = tentative_g + heuristic(neighbor, goal)
                
                if neighbor not in open_set:
                    open_set.put(neighbor, priority=f_score[neighbor])
    
    return []  # æ— è·¯å¾„
```

#### æ€§èƒ½ä¼˜åŒ–

1. **ä¼˜å…ˆé˜Ÿåˆ—**: ä½¿ç”¨å †æ’åºï¼ŒæŸ¥æ‰¾æœ€å°få€¼çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)
2. **é—­é›†åˆ**: é¿å…é‡å¤è®¿é—®å·²æ‰©å±•èŠ‚ç‚¹
3. **é‚»åŸŸç¼“å­˜**: é¢„è®¡ç®—8é‚»åŸŸåç§»é‡
4. **æ—©æœŸç»ˆæ­¢**: æ‰¾åˆ°ç›®æ ‡ç«‹å³è¿”å›

---

## âš™ï¸ é…ç½®è¯´æ˜

### é€šä¿¡å‚æ•°

```python
# btlink.py
SERIAL_PORT = "COM7"           # ä¸²å£ç«¯å£
BAUDRATE = 921600              # æ³¢ç‰¹ç‡
TIMEOUT = 0.01                 # è¯»å–è¶…æ—¶ï¼ˆç§’ï¼‰

# é˜Ÿåˆ—é…ç½®
ENCODER_QUEUE_SIZE = 100       # ç¼–ç å™¨é˜Ÿåˆ—å®¹é‡
LIDAR_QUEUE_SIZE = 1           # é›·è¾¾é˜Ÿåˆ—å®¹é‡
```

### SLAMå‚æ•°

```python
# main_robot.py
MAP_SIZE_MM = 8000             # åœ°å›¾å°ºå¯¸ï¼ˆmmï¼‰
MAP_QUALITY_MM = 10            # åœ°å›¾åˆ†è¾¨ç‡ï¼ˆmm/pixelï¼‰
WHEEL_RADIUS_M = 0.0325        # è½®åŠå¾„ï¼ˆmï¼‰
HALF_WHEELBASE_M = 0.084       # åŠè½´è·ï¼ˆmï¼‰
CPR = 1650                     # ç¼–ç å™¨çº¿æ•°

# SLAMå¼•æ“é…ç½®
LASER_SCAN_SIZE = 520          # æ¿€å…‰ç‚¹æ•°
LASER_SCAN_RATE_HZ = 5         # æ‰«æé¢‘ç‡
LASER_DETECTION_ANGLE = 360    # æ£€æµ‹è§’åº¦èŒƒå›´
LASER_DISTANCE_NO_DETECTION = 8000  # æœ€å¤§æ£€æµ‹è·ç¦»
```

### è§„åˆ’å‚æ•°

```python
# planner/planning_config.py

# Frontieræ£€æµ‹
FRONTIER_MIN_SIZE = 20         # æœ€å°Frontierå°ºå¯¸ï¼ˆåƒç´ ï¼‰
FRONTIER_MIN_SPACING = 50      # Frontieré—´æœ€å°é—´è·ï¼ˆåƒç´ ï¼‰

# è·¯å¾„è§„åˆ’
ROBOT_RADIUS_MM = 100          # æœºå™¨äººåŠå¾„ï¼ˆmmï¼‰
OBSTACLE_INFLATION = 2         # éšœç¢ç‰©è†¨èƒ€ç³»æ•°
PATH_RESOLUTION = 10           # è·¯å¾„åˆ†è¾¨ç‡ï¼ˆmmï¼‰

# è·¯å¾„å¹³æ»‘
SMOOTHNESS_FACTOR = 0.5        # å¹³æ»‘å› å­ï¼ˆ0-1ï¼‰
SPLINE_POINTS = 50             # æ ·æ¡æ’å€¼ç‚¹æ•°

# ç›®æ ‡é€‰æ‹©
DISTANCE_WEIGHT = 0.6          # è·ç¦»æƒé‡
INFO_GAIN_WEIGHT = 0.4         # ä¿¡æ¯å¢ç›Šæƒé‡
MIN_GOAL_DISTANCE = 200        # æœ€å°ç›®æ ‡è·ç¦»ï¼ˆmmï¼‰
```

### å¯è§†åŒ–å‚æ•°

```python
# slam_map/map_visualizer.py

# é¢œè‰²é…ç½®
COLOR_UNKNOWN = (128, 128, 128)    # ç°è‰²
COLOR_FREE = (255, 255, 255)       # ç™½è‰²
COLOR_OCCUPIED = (0, 0, 0)         # é»‘è‰²
COLOR_ROBOT = (0, 0, 255)          # çº¢è‰²
COLOR_PATH = (255, 0, 0)           # è“è‰²
COLOR_FRONTIER = (0, 255, 0)       # ç»¿è‰²

# HUDé…ç½®
HUD_FONT = cv2.FONT_HERSHEY_SIMPLEX
HUD_FONT_SCALE = 0.5
HUD_LINE_SPACING = 20
```

---

## ğŸŒŠ æ•°æ®æµç¨‹

### å®Œæ•´æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®é‡‡é›†å±‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚                          â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ ç¼–ç å™¨æ•°æ®   â”‚          â”‚  é›·è¾¾æ•°æ®      â”‚
                      â”‚   10ms      â”‚          â”‚   200ms       â”‚
                      â”‚   21å­—èŠ‚    â”‚          â”‚   2604å­—èŠ‚    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                          â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                      â”‚         è§£æ & é˜Ÿåˆ—ç®¡ç† (btlink)       â”‚
                      â”‚  ç¼–ç å™¨é˜Ÿåˆ—(100) | é›·è¾¾é˜Ÿåˆ—(1)         â”‚
                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                          â”‚
                             â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å¤„ç†å±‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                          â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ ç¼–ç å™¨ç§¯åˆ†   â”‚          â”‚  é›·è¾¾é¢„å¤„ç†    â”‚
                      â”‚  ç´¯åŠ å™¨      â”‚          â”‚  360åº¦è½¬æ¢    â”‚
                      â”‚  100Hzé‡‡æ ·  â”‚          â”‚  è´¨é‡è¿‡æ»¤     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                          â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                 â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                 â”‚  SLAMæ›´æ–°   â”‚
                                 â”‚  ä½å§¿ä¼°è®¡   â”‚
                                 â”‚  åœ°å›¾æ„å»º   â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä»»åŠ¡è§„åˆ’å±‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                 â”‚                 â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
               â”‚ Frontier     â”‚   â”‚  è·¯å¾„è§„åˆ’  â”‚   â”‚  å‘½ä»¤ç”Ÿæˆ   â”‚
               â”‚   æ£€æµ‹       â”‚â”€â”€â–¶â”‚   A*ç®—æ³•  â”‚â”€â”€â–¶â”‚  è½¬å‘+ç›´è¡Œ  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‘½ä»¤æ‰§è¡Œå±‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                                   â”‚  ä¸²å£å‘é€   â”‚
                                                   â”‚  cmd_idåŒæ­¥ â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
                                                   [ä¸‹ä½æœºæ‰§è¡Œ]
```

### æ—¶åºå›¾

```
æ—¶é—´è½´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶

ç¼–ç å™¨    â”ƒ     â”ƒ     â”ƒ     â”ƒ     â”ƒ     â”ƒ     â”ƒ     â”ƒ     â”ƒ  
10msé—´éš”  0ms  10ms  20ms  30ms  40ms  50ms  60ms  70ms  80ms ...

é›·è¾¾      â”ƒ                                   â”ƒ
200msé—´éš” 0ms                                200ms                400ms

SLAM           â–³ (ä¸è§¦å‘)                      â–³ (è§¦å‘ï¼)
æ›´æ–°æ—¶æœº        çŠ¶æ€=1(è½¬å‘ä¸­)                   çŠ¶æ€è½¬æ¢1â†’2

ä»»åŠ¡           â—‡                              â—‡
è§„åˆ’å‘¨æœŸ        Frontieræ£€æµ‹                    è·¯å¾„è§„åˆ’

å‘½ä»¤          â—                               â—
å‘é€           cmd_id=1                        cmd_id=2
              (è½¬å‘30Â°)                        (ç›´è¡Œ0.5m)
```

---

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„è§„åˆ’å™¨

```python
# planner/my_planner.py

class MyCustomPlanner:
    """è‡ªå®šä¹‰è·¯å¾„è§„åˆ’å™¨"""
    
    def __init__(self, config):
        self.config = config
    
    def plan_path(self, start, goal, map_data):
        """
        å®ç°ä½ çš„è§„åˆ’ç®—æ³•
        
        Args:
            start: èµ·ç‚¹ (x, y)
            goal: ç»ˆç‚¹ (x, y)
            map_data: åœ°å›¾æ•°æ® (numpyæ•°ç»„)
            
        Returns:
            path: è·¯å¾„ç‚¹åˆ—è¡¨ [(x1, y1), (x2, y2), ...]
        """
        # ä½ çš„ç®—æ³•å®ç°
        pass

# åœ¨main_robot.pyä¸­ä½¿ç”¨
from planner.my_planner import MyCustomPlanner

planner = MyCustomPlanner(config)
path = planner.plan_path(start, goal, map_data)
```

### æ·»åŠ æ–°çš„Frontieré€‰æ‹©ç­–ç•¥

```python
# planner/my_selector.py

class MyFrontierSelector:
    """è‡ªå®šä¹‰Frontieré€‰æ‹©ç­–ç•¥"""
    
    def select_best_frontier(self, frontiers, robot_pos):
        """
        æ ¹æ®è‡ªå®šä¹‰ç­–ç•¥é€‰æ‹©æœ€ä½³Frontier
        
        Args:
            frontiers: Frontieråˆ—è¡¨
            robot_pos: æœºå™¨äººå½“å‰ä½ç½®
            
        Returns:
            best_frontier: æœ€ä½³Frontierè´¨å¿ƒ
        """
        scores = []
        for frontier in frontiers:
            score = self.compute_score(frontier, robot_pos)
            scores.append(score)
        
        best_idx = np.argmax(scores)
        return self.compute_centroid(frontiers[best_idx])
    
    def compute_score(self, frontier, robot_pos):
        """
        è®¡ç®—Frontierå¾—åˆ†
        
        ç¤ºä¾‹ï¼šç»¼åˆè€ƒè™‘è·ç¦»ã€å¤§å°ã€æ–¹å‘
        """
        centroid = self.compute_centroid(frontier)
        
        # è·ç¦»å› å­ï¼ˆè·ç¦»è¶Šè¿‘å¾—åˆ†è¶Šé«˜ï¼‰
        distance = euclidean_distance(robot_pos, centroid)
        distance_score = 1.0 / (1.0 + distance / 1000.0)
        
        # å¤§å°å› å­ï¼ˆé¢ç§¯è¶Šå¤§å¾—åˆ†è¶Šé«˜ï¼‰
        size_score = len(frontier) / 100.0
        
        # æ–¹å‘å› å­ï¼ˆä¸å½“å‰æœå‘ä¸€è‡´å¾—åˆ†è¶Šé«˜ï¼‰
        direction_score = compute_direction_alignment(robot_pos, centroid)
        
        # åŠ æƒç»¼åˆ
        total_score = (0.5 * distance_score + 
                      0.3 * size_score + 
                      0.2 * direction_score)
        
        return total_score
```

### æ‰©å±•å¯è§†åŒ–åŠŸèƒ½

```python
# slam_map/custom_viz.py

from slam_map.map_visualizer import MapVisualizer

class EnhancedVisualizer(MapVisualizer):
    """å¢å¼ºç‰ˆå¯è§†åŒ–å™¨"""
    
    def draw_heatmap(self, data):
        """ç»˜åˆ¶çƒ­åŠ›å›¾"""
        heatmap = cv2.applyColorMap(data, cv2.COLORMAP_JET)
        self.image = cv2.addWeighted(self.image, 0.7, heatmap, 0.3, 0)
    
    def draw_trajectory(self, trajectory):
        """ç»˜åˆ¶å†å²è½¨è¿¹"""
        points = np.array(trajectory, dtype=np.int32)
        cv2.polylines(self.image, [points], False, (255, 255, 0), 2)
    
    def draw_debug_info(self, debug_data):
        """ç»˜åˆ¶è°ƒè¯•ä¿¡æ¯"""
        y_offset = 400
        for key, value in debug_data.items():
            text = f"{key}: {value}"
            cv2.putText(self.image, text, (10, y_offset),
                       cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 255), 1)
            y_offset += 20
```

### å•å…ƒæµ‹è¯•

```python
# tests/test_astar.py

import unittest
from planner.astar_planner import AStarPlanner
import numpy as np

class TestAStarPlanner(unittest.TestCase):
    def setUp(self):
        self.planner = AStarPlanner()
        self.map_data = np.zeros((100, 100), dtype=np.uint8)
    
    def test_straight_path(self):
        """æµ‹è¯•ç›´çº¿è·¯å¾„"""
        start = (10, 10)
        goal = (10, 90)
        path = self.planner.plan_path(start, goal, self.map_data)
        
        self.assertIsNotNone(path)
        self.assertEqual(path[0], start)
        self.assertEqual(path[-1], goal)
    
    def test_obstacle_avoidance(self):
        """æµ‹è¯•éšœç¢ç‰©é¿è®©"""
        # æ·»åŠ éšœç¢ç‰©å¢™
        self.map_data[50, 10:90] = 255
        
        start = (10, 50)
        goal = (90, 50)
        path = self.planner.plan_path(start, goal, self.map_data)
        
        self.assertIsNotNone(path)
        # éªŒè¯è·¯å¾„ç»•è¿‡éšœç¢ç‰©
        for (x, y) in path:
            self.assertNotEqual(self.map_data[x, y], 255)
    
    def test_no_path(self):
        """æµ‹è¯•æ— è·¯å¾„æƒ…å†µ"""
        # ç”¨éšœç¢ç‰©å®Œå…¨åŒ…å›´ç›®æ ‡ç‚¹
        self.map_data[80:90, 80:90] = 255
        
        start = (10, 10)
        goal = (85, 85)
        path = self.planner.plan_path(start, goal, self.map_data)
        
        self.assertEqual(len(path), 0)

if __name__ == '__main__':
    unittest.main()
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ç¨‹åºå¯åŠ¨åæ— æ³•è¿æ¥ä¸²å£

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ä¸²å£å·æ˜¯å¦æ­£ç¡®ï¼š`python -m serial.tools.list_ports`
2. ç¡®è®¤æ³¢ç‰¹ç‡åŒ¹é…ï¼š921600
3. æ£€æŸ¥ä¸²å£æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨
4. Windowsç”¨æˆ·ï¼šæ£€æŸ¥è®¾å¤‡ç®¡ç†å™¨ä¸­çš„COMç«¯å£

### Q2: SLAMåœ°å›¾ä¸æ›´æ–°

**å¯èƒ½åŸå› **:
1. ç¼–ç å™¨æ•°æ®æœªæ”¶åˆ° â†’ æ£€æŸ¥ç¼–ç å™¨é˜Ÿåˆ—ç»Ÿè®¡
2. é›·è¾¾æ•°æ®è´¨é‡å·® â†’ æŸ¥çœ‹HUDä¸­çš„é›·è¾¾ç‚¹æ•°
3. çŠ¶æ€è½¬æ¢æœªè§¦å‘ â†’ ç¡®è®¤statuså€¼æ˜¯å¦æ­£å¸¸å˜åŒ–
4. è¿åŠ¨å¢é‡è¿‡å° â†’ æ£€æŸ¥ç¼–ç å™¨ç´¯åŠ å€¼

**è°ƒè¯•æ–¹æ³•**:
```python
# æ·»åŠ è°ƒè¯•æ—¥å¿—
print(f"Encoder frames: {encoder_count}")
print(f"Status: {encoder_frame.status}")
print(f"Accumulated: left={acc_left}, right={acc_right}")
```

### Q3: è·¯å¾„è§„åˆ’å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥Frontieræ˜¯å¦æ£€æµ‹åˆ°ï¼š`len(frontiers) > 0`
2. ç¡®è®¤ç›®æ ‡ç‚¹å¯è¾¾æ€§ï¼š`reachability.is_reachable(goal)`
3. æŸ¥çœ‹A*æœç´¢æ—¥å¿—ï¼šæ˜¯å¦é™·å…¥æ­»å¾ªç¯
4. å¢å¤§éšœç¢ç‰©è†¨èƒ€åŠå¾„ï¼š`OBSTACLE_INFLATION += 1`

### Q4: æœºå™¨äººè½¬åœˆä¸åœ

**åŸå› åˆ†æ**:
- cmd_idåŒæ­¥å¤±è´¥
- çŠ¶æ€æœºå¡åœ¨æŸä¸ªçŠ¶æ€
- å‘½ä»¤é˜Ÿåˆ—æœªæ¸…ç©º

**è§£å†³æ–¹æ¡ˆ**:
```python
# é‡ç½®çŠ¶æ€æœº
controller.reset()

# æ¸…ç©ºå‘½ä»¤é˜Ÿåˆ—
while not command_queue.empty():
    command_queue.get()

# å¼ºåˆ¶è¿›å…¥ç©ºé—²çŠ¶æ€
robot_status = 0
```

### Q5: ç¼–ç å™¨ç´¯åŠ å€¼å¼‚å¸¸

**æ£€æŸ¥é¡¹**:
1. ä¸‹ä½æœºæ˜¯å¦å‘é€ç´¯ç§¯å€¼è€Œéå¢é‡
2. ç´¯åŠ å™¨æ˜¯å¦åœ¨SLAMè§¦å‘åé‡ç½®
3. ç¼–ç å™¨çº¿æ•°(CPR)æ˜¯å¦æ­£ç¡®é…ç½®

**æ­£ç¡®çš„ç´¯åŠ é€»è¾‘**:
```python
# æ­£ç¡®
if frame_count > 0:
    delta_left = current_left - last_left
    acc_left += delta_left

# é”™è¯¯ï¼ˆä¸‹ä½æœºå‘é€å¢é‡ï¼‰
acc_left += current_left  # âŒ ä¸è¦è¿™æ ·å†™
```

### Q6: åœ°å›¾å‡ºç°"é¬¼å½±"

**ç°è±¡**: åœ°å›¾ä¸­å‡ºç°ä¸å­˜åœ¨çš„éšœç¢ç‰©

**åŸå› **: SLAMä½å§¿ä¼°è®¡æ¼‚ç§»

**è§£å†³æ–¹æ¡ˆ**:
1. å¢åŠ SLAMæ›´æ–°é¢‘ç‡
2. æ”¹å–„ç¼–ç å™¨æ•°æ®è´¨é‡
3. æ·»åŠ é—­ç¯æ£€æµ‹
4. ä½¿ç”¨æ›´é«˜ç²¾åº¦çš„é‡Œç¨‹è®¡æ¨¡å‹

### Q7: ç³»ç»ŸCPUå ç”¨è¿‡é«˜

**ä¼˜åŒ–å»ºè®®**:
1. é™ä½åœ°å›¾å¯è§†åŒ–é¢‘ç‡ï¼š`cv2.waitKey(100)` â†’ `cv2.waitKey(200)`
2. å‡å°‘SLAMæ›´æ–°é¢‘ç‡ï¼šä»…åœ¨å¿…è¦æ—¶è§¦å‘
3. ä¼˜åŒ–A*æœç´¢ï¼šä½¿ç”¨JPSç®—æ³•
4. å¤šçº¿ç¨‹ä¼˜åŒ–ï¼šå°†å¯è§†åŒ–ç§»åˆ°å•ç‹¬çº¿ç¨‹

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT License** å¼€æºåè®®ã€‚

```
MIT License

Copyright (c) 2025 SLAM-car Project

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®ä½¿ç”¨äº†ä»¥ä¸‹å¼€æºåº“ï¼š

- **BreezySLAM**: SLAMç®—æ³•æ ¸å¿ƒ - https://github.com/simondlevy/BreezySLAM
- **NumPy**: ç§‘å­¦è®¡ç®—åŸºç¡€ - https://numpy.org/
- **OpenCV**: è®¡ç®—æœºè§†è§‰ä¸å¯è§†åŒ– - https://opencv.org/
- **PySerial**: ä¸²å£é€šä¿¡ - https://github.com/pyserial/pyserial

ç‰¹åˆ«æ„Ÿè°¢æ‰€æœ‰ä¸ºå¼€æºç¤¾åŒºåšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---


<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªStarï¼â­**

Made with â¤ï¸ by SLAM-car Team

</div>
